# Clip My Course v3 Starter

A production-ready Next.js 15 starter template with complete authentication, admin dashboard, and role-based access control.

## 🚀 Quick Start

```bash
# Install dependencies
npm install

# Configure environment
npm run setup-env

# Setup database
npm run db:reset --yes

# Start development server
npm run dev:open
```

## 📚 Legal Documents System

### **How It Works**
The app now uses a **dynamic markdown rendering system** for all legal documents:

1. **Markdown files** are stored in the `legal/` folder
2. **Dynamic pages** automatically read and render the markdown content
3. **Edit any markdown file** → **Changes appear instantly** on the live page

### **Available Legal Pages**
- **Terms of Use:** `/terms` (reads from `legal/terms-of-use.md`)
- **Privacy Policy:** `/privacy` (reads from `legal/privacy-policy.md`)
- **General Disclaimer:** `/disclaimer` (reads from `legal/general-disclaimer.md`)
- **Cookie Policy:** `/cookies` (reads from `legal/cookie-policy.md`)
- **DMCA Policy:** `/dmca` (reads from `legal/dmca-policy.md`)

### **Editing Legal Content**
1. **Navigate to** the `legal/` folder in your project
2. **Open any `.md` file** (e.g., `terms-of-use.md`)
3. **Make your changes** and save the file
4. **Refresh the corresponding page** in your browser
5. **See changes immediately!** ✨

### **Example Workflow**
```
Edit: legal/terms-of-use.md
  ↓
Save file
  ↓
Visit: http://localhost:3000/terms
  ↓
Changes appear instantly!
```

## 🏗️ Architecture

This is a production-ready Next.js 15 starter template with complete authentication, admin dashboard, and role-based access control.

### Core Technologies
- **Next.js 15**: App Router, Server Components, Server Actions
- **TypeScript**: Full type safety throughout
- **Prisma**: ORM with SQLite (production database ready)
- **Tailwind CSS**: Responsive styling with dark mode
- **shadcn/ui**: Accessible component library
- **bcrypt**: Password hashing
- **JWT**: Stateless authentication
- **ULID**: Universally Unique Lexicographically Sortable IDs
- **next-themes**: Theme management

### Project Structure
```
app/
├── actions/          # Server Actions for database operations
├── admin/           # Admin dashboard (protected routes)
├── api/             # API routes for external integrations
├── auth/            # Authentication pages and flows
└── page.tsx         # Home page with smart routing

components/
├── ui/              # shadcn/ui base components
├── auth/            # Authentication forms and flows
└── admin/           # Admin dashboard components

lib/
├── auth/            # Authentication utilities and permissions
├── email/           # Email service with provider pattern
├── utils/           # Utility modules
└── prisma.ts        # Centralized Prisma client with ULID middleware

legal/               # 📁 Legal Documents (Markdown)
├── terms-of-use.md
├── privacy-policy.md
├── general-disclaimer.md
├── cookie-policy.md
└── dmca-policy.md
```

## 🔐 Authentication

### Supported Flows
1. **First-Time Setup**: Auto-redirect to admin setup if no admin exists
2. **Sign Up**: Email/password → verification email → account activation
3. **Sign In**: Email/password OR magic link authentication
4. **Password Reset**: Forgot password → email link → reset form → success
5. **Email Verification**: Automatic after signup, 24-hour expiry

### Admin Management
1. **User Management**: Search, view, edit, assign roles, send password resets
2. **Role Management**: Create custom roles, assign/remove, protect system roles
3. **Database Viewer**: Browse all tables, view data with pagination, SQL injection protection
4. **Protection Rules**: Cannot remove own admin role, system roles protected

## 🗄️ Database

### Schema Design Principles
- All tables include: id (ULID string), created_at, updated_at, deleted_at
- IDs are ULID strings (26 characters), auto-generated by Prisma middleware
- Use soft deletes (set deleted_at) instead of hard deletes
- Always filter by deleted_at: null for active records

### Development Flow
**MANDATORY: Follow this sequence for schema changes**

1. **Modify schema.prisma**
2. **Create migration FIRST** (before generate)
3. **Migration automatically runs generate**

```bash
# For structural changes
npx prisma migrate dev --name "descriptive-change-name"

# For non-structural changes (comments only)
npx prisma generate
```

## 🎨 Theme System

### Features
- Light/Dark/System modes
- Persistent user preference
- Theme toggle on all pages
- Smooth transitions without flash

## 🚀 Production Considerations

### Environment Variables
- `JWT_SECRET`: Change in production
- `DATABASE_URL`: Use PostgreSQL/MySQL for production
- `NEXT_PUBLIC_APP_URL`: Set to production domain
- Email provider credentials

### Security Checklist
- [ ] Update JWT_SECRET
- [ ] Configure production email provider
- [ ] Set up HTTPS
- [ ] Configure production database
- [ ] Review CORS settings
- [ ] Set up monitoring

## 📝 Common Operations

### Reset Project
```bash
npm run reset          # Interactive mode
npm run reset --yes    # Skip confirmation
```

### Database Management
```bash
npx prisma studio      # GUI database browser
npx prisma generate    # Regenerate client
npm run db:seed        # Seed default data
```

### Development
```bash
npm run dev           # Start development server
npm run build         # Production build
npm run lint          # Code linting
```

## 🔗 Links

- **Homepage:** `/`
- **Admin Dashboard:** `/admin`
- **Courses:** `/courses`
- **Create Course:** `/create-course`
- **Terms of Use:** `/terms`
- **Privacy Policy:** `/privacy`
- **General Disclaimer:** `/disclaimer`
- **Cookie Policy:** `/cookies`
- **DMCA Policy:** `/dmca`

---

📌 **Pro tip**: Keep `npm run dev` running while you work - it auto-refreshes when you make changes!
